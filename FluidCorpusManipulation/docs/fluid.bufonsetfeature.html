<!--
Part of the Fluid Corpus Manipulation Project (http://www.flucoma.org/)
Copyright 2017-2019 University of Huddersfield.
Licensed under the BSD-3 License.
See license.md file in the project root for full license information.
This project has received funding from the European Research Council (ERC)
under the European Unionâ€™s Horizon 2020 research and innovation programme
(grant agreement No 725899).
-->
<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="./_c74_common.css">
<title>fluid.bufonsetfeature Reference</title>
<style>
	* {
		font-family:system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
		--blue: rgb(80,164,252);
		--dark-blue: #204265;
	}

	body {
		padding: 1em;
	}

	h1 {
		text-decoration: underline;
		background-color: var(--blue);
		color: white;
		padding: 0.25em;
		margin: 0;
	}
	h2 {
		border-bottom: 0.5px solid rgba(128, 128, 128, 0.513);
	}

	a {
		color: var(--blue);
	}

	a:hover {
		background-color: var(--blue);
		color: white;
	}
	
	.type, .defaultval { 
		font-weight: normal; 
  }
</style> 
</head>
<body>
  <h1 class="ref_title">fluid.bufonsetfeature</h1>
  <div class="digest">Buffer-Based Spectral Difference Feature</div>
  <section class="object_description">
    <h2>Description</h2> 
    
    <p>Calculate the spectral difference feature used by <a href="fluid.bufonsetslice.html">fluid.bufonsetslice</a>.</p>

    
  </section> 
  <section class="object_discussion"> 
    <h2>Discussion</h2> 
    
    <p>Given a source buffer, calculates the feature used by <a href="fluid.bufonsetslice.html">fluid.bufonsetslice</a> and copies it to another buffer.</p>
<p>The metric for calculating difference can be chosen from a curated selection, lending the algorithm toward slicing a broad range of musical materials.</p>


    <p>Read more about fluid.bufonsetfeature on the <a href='https://learn.flucoma.org/reference/onsetfeature'>learn platform</a>.</p>
    
    <p>fluid.bufonsetfeature is part of the Fluid Decomposition Toolkit of the FluCoMa project. For more explanations, learning material, and discussions on its musicianly uses, visit <a href="http://www.flucoma.org/">flucoma.org</a>.</p>
  </section>
  <section class="argument_section">
    <h2>Arguments</h2></section> 
  <section class="attribute_section">
    <h2>Attributes</h2><div class="attribute_group">
      <h3 class="attribute_name">features
        <span class="type"> [symbol]</span>
        <span class="defaultval"> (default: None)</span>
      </h3>
      <div class="description"><p>The buffer where the onset features will be written to.</p>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">fftsettings
        <span class="type"> [int]</span>
        <span class="defaultval"> (default: [[&#39;winSize&#39;, 1024], [&#39;hopSize&#39;, -1], [&#39;fftSize&#39;, -1]])</span>
      </h3>
      <div class="description"><p>FFT settings consist of three numbers representing the window size, hop size and FFT size in samples:</p>
<p>The hop size and fft size can both be set to -1 (and are by default), with slightly different meanings:</p>
<ul class="simple">
<li>For the hop size, -1 = <code>windowsize/2</code></li>
<li>For the FFT size, -1 = <code>windowsize</code> snapped to the nearest equal / greater power of 2 (e.g. <code>windowsize 1024</code> =&gt; <code>fftsize 1024</code>, but <code>windowssize 1000</code> also =&gt; <code>fftsize 1024</code>)</li>
</ul>
<p><strong>Constraints</strong></p>
<ul class="simple">
<li>FFTSize, if != -1, will snap to the next greatest power of two &amp;gt; 4</li>
<li>The maximum FFT size is limited to the value of the <code>maxfftsize</code> argument</li>
<li>if FFT size != -1, then window size is clipped at FFT size</li>
</ul>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">filtersize
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: 5)</span>
      </h3>
      <div class="description"><p>The size of a smoothing filter that is applied on the novelty curve. A larger filter size allows for cleaner cuts on very sharp changes.</p>
<p><strong>Constraints</strong></p>
<ul class="simple">
<li>Minimum: <code>1</code></li>
<li>Maximum: <code>101</code></li>
<li>Snaps to odd numbers</li>
</ul>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">framedelta
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: 0)</span>
      </h3>
      <div class="description"><p>For certain metrics (HFC, SpectralFlux, MKL, Cosine), the distance does not have to be computed between consecutive frames. By default (0) it is, otherwise this sets the distance between the comparison window in samples.</p>
<p><strong>Constraints</strong></p>
<ul class="simple">
<li>Minimum: <code>0</code></li>
<li>Maximum: <code>8192</code></li>
</ul>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">maxfftsize
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: -1)</span>
      </h3>
      <div class="description"><p>Set an explicit upper bound on the FFT size at object instantiation. The default of -1 sets this to whatever the initial FFT size is</p>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">metric
        <span class="type"> [int]</span>
        <span class="defaultval"> (default: 0)</span>
      </h3>
      <div class="description"><p>The metric used to derive a difference curve between spectral frames. It can be any of the following:</p>
</div><div class="enumvals">      
      <ol start='0'><li>
          <p><strong>Energy</strong> thresholds on (sum of squares of magnitudes / nBins) (like Onsets power)</p>

        </li><li>
          <p><strong>HFC</strong> thresholds on (sum of (squared magnitudes * binNum) / nBins)</p>

        </li><li>
          <p><strong>SpectralFlux</strong> thresholds on (difference in magnitude between consecutive frames, half rectified)</p>

        </li><li>
          <p><strong>MKL</strong> thresholds on (sum of log of magnitude ratio per bin) (or equivalently, sum of difference of the log magnitude per bin) (like Onsets mkl)</p>

        </li><li>
          <p><strong>IS</strong> (WILL PROBABLY BE REMOVED) Itakura - Saito divergence (see literature)</p>

        </li><li>
          <p><strong>Cosine</strong> thresholds on (cosine distance between comparison frames)</p>

        </li><li>
          <p><strong>PhaseDev</strong> takes the past 2 frames, projects to the current, as anticipated if it was a steady state, then compute the sum of the differences, on which it thresholds (like Onsets phase)</p>

        </li><li>
          <p><strong>WPhaseDev</strong> same as PhaseDev, but weighted by the magnitude in order to remove chaos noise floor (like Onsets wphase)</p>

        </li><li>
          <p><strong>ComplexDev</strong> same as PhaseDev, but in the complex domain - the anticipated amp is considered steady, and the phase is projected, then a complex subtraction  is done with the actual present frame. The sum of magnitudes is used to threshold (like Onsets complex)</p>

        </li><li>
          <p><strong>RComplexDev</strong> same as above, but rectified (like Onsets rcomplex)</p>

        </li></ol>
      </div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">numchans
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: -1)</span>
      </h3>
      <div class="description"><p>For multichannel sources, how many channels should be summed.</p>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">numframes
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: -1)</span>
      </h3>
      <div class="description"><p>How many frames should be processed.</p>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">padding
        <span class="type"> [int]</span>
        <span class="defaultval"> (default: 1)</span>
      </h3>
      <div class="description"><p>Controls the zero-padding added to either end of the source buffer or segment. Padding ensures all values are analysed. Possible values are:</p>
</div><div class="enumvals">      
      <ol start='0'><li>
          <p>No padding - The first analysis window starts at time 0, and the samples at either end will be tapered by the STFT windowing function.</p>

        </li><li>
          <p>Half the window size - The first sample is centred in the analysis window ensuring that the start and end of the segment are accounted for in the analysis.</p>

        </li><li>
          <p>Window size minus the hop size - Mode 2 can be useful when the overlap factor (window size / hop size) is greater than 2, to ensure that the input samples at either end of the segment are covered by the same number of analysis frames as the rest of the analysed material.</p>

        </li></ol>
      </div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">source
        <span class="type"> [symbol]</span>
        <span class="defaultval"> (default: None)</span>
      </h3>
      <div class="description"><p>The buffer to use as the source material to be sliced through novelty identification. The different channels of multichannel buffers will be summed.</p>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">startchan
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: 0)</span>
      </h3>
      <div class="description"><p>For multichannel sources, which channel should be processed.</p>
<p><strong>Constraints</strong></p>
<ul class="simple">
<li>Minimum: <code>0</code></li>
</ul>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">startframe
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: 0)</span>
      </h3>
      <div class="description"><p>Where in the srcBuf should the slicing process start, in samples.</p>
<p><strong>Constraints</strong></p>
<ul class="simple">
<li>Minimum: <code>0</code></li>
</ul>
</div><!--  -->
    </div><div class="attribute_group">
      <h3 class="attribute_name">warnings
        <span class="type"> [number]</span>
        <span class="defaultval"> (default: 0)</span>
      </h3>
      <div class="description"><p>Enable warnings to be issued whenever a parameter value is constrained (e.g. clipped)</p>
</div><!--  -->
    </div></section> 
  <section class="method_section"> 
    <h2>Messages</h2><div class="method_group">
      <h3 class="method_name" name="bang">bang</h3>
      <div class="description"> A bang will commence processing on object given its current settings, unless it is already busy. In that case, the behaviour depends on the value of the <span class="messagename" data-message="queue"> queue </span>
        attribute. </div>
    </div>
    <div class="method_group">
      <h3 class="method_name" name="cancel">cancel</h3>
      <div class="description"> When processing in non-blocking mode, this will cancel the job underway, without updating destination buffers. </div>
    </div><div class="method_group">
      <h3 class="method_name" name="reset">reset</h3>
      <div class="description"> Calling <span class="messagename" data-message="reset"> reset </span> will change parameter values back to those the object was <em> created </em> with, i.e. any attribute values set in the box will be retained </div>
    </div>
  </section> 
  <section class="seealso"> 
    <h2>See Also</h2><h3 class="seealso_name"><a href="fluid.bufonsetslice.html">BufOnsetSlice</a></h3><h3 class="seealso_name"><a href="fluid.bufnoveltyfeature.html">BufNoveltyFeature</a></h3><h3 class="seealso_name"><a href="fluid.bufampfeature.html">BufAmpFeature</a></h3><h3 class="seealso_name"><a href="fluid.bufonsetfeature.html">BufOnsetFeature</a></h3></section> 
</body>
</html>